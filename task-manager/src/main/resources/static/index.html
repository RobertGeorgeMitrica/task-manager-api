<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager Pro</title>
    <style>
            :root {
                --primary: #4a90e2;
                --success: #2ecc71;
                --danger: #e74c3c;
                --bg: #f8f9fa;
            }

            body {
                font-family: 'Inter', -apple-system, sans-serif;
                margin: 0; padding: 40px;
                background: var(--bg); color: #2d3436;
            }

            .container { max-width: 1100px; margin: auto; }

            .card {
                background: white; padding: 20px; margin-bottom: 20px;
                border-radius: 12px; border-left: 5px solid var(--primary);
                box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
                transition: transform 0.2s;
            }

            .card:hover { transform: translateY(-3px); }

            .task-header { display: flex; justify-content: space-between; align-items: flex-start; }

            .completed {
                text-decoration: line-through; color: #b2bec3;
            }

            .card.is-completed { border-left-color: var(--success); }

            input {
                width: 100%; padding: 12px; margin: 0;
                border: 2px solid #eee; border-radius: 8px; outline: none;
                transition: border-color 0.3s; box-sizing: border-box;
            }

            input:focus { border-color: var(--primary); }

            /* Butoanele generale din carduri */
            .btn {
                padding: 10px 20px; border-radius: 8px; border: none;
                font-weight: 600; cursor: pointer; transition: 0.3s;
            }

            .btn-save { background: var(--primary); color: white; width: 100%; }
            .btn-complete { background: var(--success); color: white; margin-right: 10px; }
            .btn-undo { background: #636e72; color: white; margin-right: 10px; }
            .btn-delete { background: var(--danger); color: white; }
            .btn:hover { opacity: 0.85; transform: scale(0.98); }

            /* --- STILURI NOI PENTRU FILTRARE --- */
            .filter-container {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin: 20px 0;
            }

            .btn-filter {
               background: #e9ecef;
               border: none;
               padding: 12px 20px;
               border-radius: 10px; /* Mai puÈ›in rotunjite pentru aspect de listÄƒ */
               cursor: pointer;
               font-weight: 600;
               color: #636e72;
               text-align: left;
               padding-left: 30px;
               display: block;
               transition: all 0.3s;
               width: 100%; /* SÄƒ ocupe tot spaÈ›iul coloanei */
            }

            .btn-filter:hover {
                background: #dfe6e9;
            }

            .btn-filter.active-filter {
                background: var(--primary);
                color: white;
                box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3);
            }
    </style>

</head>
<body>

<div class="container">
    <h1>Task Manager</h1>

    <div class="card" style="display: flex; gap: 20px; align-items: center; padding: 20px; border-left: 5px solid var(--primary); margin-bottom: 40px;">
        <input type="text" id="titleInput" placeholder="Task title..." style="flex: 2;">
        <input type="text" id="descInput" placeholder="Add a description..." style="flex: 3;">
        <button class="btn btn-save" onclick="createTask()" style="width: auto; padding: 12px 30px; white-space: nowrap;">
            Add Task
        </button>
    </div>

    <div style="display: flex; gap: 30px; align-items: flex-start;">

        <div style="flex: 1; position: sticky; top: 40px;">
            <div class="card" id="stats" style="border-left: 5px solid #636e72; padding: 15px; margin-bottom: 20px;">
            </div>

            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button class="btn-filter active-filter" onclick="filterTasks('all', this)">All Tasks</button>
                <button class="btn-filter" onclick="filterTasks('active', this)">To Do</button>
                <button class="btn-filter" onclick="filterTasks('completed', this)">Finished</button>
            </div>
        </div>

        <div style="flex: 3;" id="taskList">
        </div>
    </div>
</div>


<script>
    const API_URL = 'http://localhost:8080/api/tasks';
     let allTasks = []; // Memoria noastrÄƒ localÄƒ

     // --- 1. COMUNICAREA CU SERVERUL ---

     async function fetchTasks() {
         try {
             const response = await fetch(API_URL);
             allTasks = await response.json();
             renderTasks(allTasks); // DupÄƒ ce le luÄƒm, le desenÄƒm
         } catch (error) {
             console.error("Error fetching tasks:", error);
         }
     }

     async function createTask() {
         const title = document.getElementById('titleInput').value;
         const description = document.getElementById('descInput').value;

         const response = await fetch(API_URL, {
             method: 'POST',
             headers: { 'Content-Type': 'application/json' },
             body: JSON.stringify({ title, description, completed: false })
         });

         if (response.ok) {
             document.getElementById('titleInput').value = '';
             document.getElementById('descInput').value = '';
             fetchTasks();
         } else {
             alert("Failed to save. Title must be at least 3 characters.");
         }
     }

     async function deleteTask(id) {
         if(confirm("Are you sure?")) {
             await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
             fetchTasks();
         }
     }

     async function toggleTask(id, title, description, currentStatus) {
         await fetch(`${API_URL}/${id}`, {
             method: 'PUT',
             headers: { 'Content-Type': 'application/json' },
             body: JSON.stringify({ title, description, completed: !currentStatus })
         });
         fetchTasks();
     }

     // --- 2. LOGICA DE FILTRARE ---

function filterTasks(status, element) {
    document.querySelectorAll('.btn-filter').forEach(btn => btn.classList.remove('active-filter'));
    element.classList.add('active-filter');

    if (status === 'active') {
        renderTasks(allTasks.filter(t => !t.completed));
    } else if (status === 'completed') {
        renderTasks(allTasks.filter(t => t.completed));
    } else {
        renderTasks(allTasks);
    }
}

     // --- 3. DESENAREA PE ECRAN (UI) ---

     function renderTasks(tasksToDisplay) {
      // 1. Calcule de bazÄƒ
    const total = allTasks.length;
    const completed = allTasks.filter(t => t.completed).length;
    const remaining = total - completed; // IatÄƒ logica ta de Counter!
    const percent = total > 0 ? Math.round((completed / total) * 100) : 0;

    const stats = document.getElementById('stats');
    if (stats) {
        stats.innerHTML = `
            <div style="margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 0.9rem;">
                    <span>Progress: ${percent}%</span>
                    <span style="color: var(--primary);">${completed}/${total} Tasks</span>
                </div>
                <p style="margin: 5px 0 10px 0; font-size: 0.8rem; color: #636e72;">
                    ${remaining === 0 && total > 0
                        ? "ðŸŽ‰ All done! Take a break."
                        : `You have <b>${remaining}</b> tasks left to do.`}
                </p>
                <div style="background: #e9ecef; border-radius: 10px; height: 8px; overflow: hidden;">
                    <div style="background: var(--success); width: ${percent}%; height: 100%; transition: width 0.5s;"></div>
                </div>
            </div>
        `;
    }

         // DesenÄƒm lista propriu-zisÄƒ
         const list = document.getElementById('taskList');
         list.innerHTML = '';

         tasksToDisplay.forEach((task, index) => {
             const div = document.createElement('div');
             div.className = `card ${task.completed ? 'is-completed' : ''}`;
             div.innerHTML = `
                 <div class="task-header">
                     <div>
                         <span style="color: var(--primary); font-weight: bold;">#${index + 1}</span>
                         <h3 class="${task.completed ? 'completed' : ''}" style="display: inline; margin-left: 10px;">${task.title}</h3>
                         <p style="margin: 5px 0 0 35px; color: #636e72;">${task.description || 'No description'}</p>
                     </div>
                     <span style="font-size: 0.7rem; color: #b2bec3;">Ref: ${task.id}</span>
                 </div>
                 <div class="actions" style="margin-top: 15px; padding-left: 35px;">
                     <button class="btn ${task.completed ? 'btn-undo' : 'btn-complete'}"
                             onclick="toggleTask(${task.id}, '${task.title}', '${task.description}', ${task.completed})">
                         ${task.completed ? 'Undo' : 'Done'}
                     </button>
                     <button class="btn btn-delete" onclick="deleteTask(${task.id})">Remove</button>
                 </div>
             `;
             list.appendChild(div);
         });
     }

     // Pornim aplicaÈ›ia
     fetchTasks();
</script>

</body>
</html>